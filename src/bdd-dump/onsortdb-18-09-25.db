-- Création du schéma
DROP DATABASE IF EXISTS `onsort`;
CREATE DATABASE `onsort` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `onsort`;

-- Table User
CREATE TABLE `user` (
  `iduser` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(50),
  `surname` VARCHAR(50),
  `email` VARCHAR(100) UNIQUE,
  `username` VARCHAR(50),
  `password` VARCHAR(255),
  `date_of_birth` DATE,
  `is_active` TINYINT(1) DEFAULT 1,
  PRIMARY KEY (`iduser`)
) ENGINE=InnoDB;

-- Table Company
CREATE TABLE `company` (
  `idcompany` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100),
  `description` TEXT,
  PRIMARY KEY (`idcompany`)
) ENGINE=InnoDB;

-- Table Session
CREATE TABLE `session` (
  `idsession` INT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(100),
  `start_date` DATETIME,
  `end_date` DATETIME,
  PRIMARY KEY (`idsession`)
) ENGINE=InnoDB;

-- Table Activity
CREATE TABLE `activity` (
  `idactivity` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100),
  `description` TEXT,
  PRIMARY KEY (`idactivity`)
) ENGINE=InnoDB;

-- Table Picture
CREATE TABLE `picture` (
  `idpicture` INT NOT NULL AUTO_INCREMENT,
  `url` VARCHAR(255),
  `alt` VARCHAR(255),
  PRIMARY KEY (`idpicture`)
) ENGINE=InnoDB;

-- ================================
-- TABLES PIVOTS (N:N)
-- ================================

-- User ↔ Company
CREATE TABLE `user_company` (
  `iduser` INT NOT NULL,
  `idcompany` INT NOT NULL,
  PRIMARY KEY (`iduser`, `idcompany`),
  FOREIGN KEY (`iduser`) REFERENCES `user`(`iduser`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idcompany`) REFERENCES `company`(`idcompany`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

-- User ↔ Session
CREATE TABLE `user_session` (
  `iduser` INT NOT NULL,
  `idsession` INT NOT NULL,
  PRIMARY KEY (`iduser`, `idsession`),
  FOREIGN KEY (`iduser`) REFERENCES `user`(`iduser`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idsession`) REFERENCES `session`(`idsession`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

-- Company ↔ Activity
CREATE TABLE `company_activity` (
  `idcompany` INT NOT NULL,
  `idactivity` INT NOT NULL,
  PRIMARY KEY (`idcompany`, `idactivity`),
  FOREIGN KEY (`idcompany`) REFERENCES `company`(`idcompany`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idactivity`) REFERENCES `activity`(`idactivity`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

-- Session ↔ Activity
CREATE TABLE `session_activity` (
  `idsession` INT NOT NULL,
  `idactivity` INT NOT NULL,
  PRIMARY KEY (`idsession`, `idactivity`),
  FOREIGN KEY (`idsession`) REFERENCES `session`(`idsession`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idactivity`) REFERENCES `activity`(`idactivity`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

-- Company ↔ Picture
CREATE TABLE `company_picture` (
  `idcompany` INT NOT NULL,
  `idpicture` INT NOT NULL,
  PRIMARY KEY (`idcompany`, `idpicture`),
  FOREIGN KEY (`idcompany`) REFERENCES `company`(`idcompany`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idpicture`) REFERENCES `picture`(`idpicture`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

-- Activity ↔ Picture
CREATE TABLE `activity_picture` (
  `idactivity` INT NOT NULL,
  `idpicture` INT NOT NULL,
  PRIMARY KEY (`idactivity`, `idpicture`),
  FOREIGN KEY (`idactivity`) REFERENCES `activity`(`idactivity`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`idpicture`) REFERENCES `picture`(`idpicture`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;